(this["webpackJsonporb-stream"]=this["webpackJsonporb-stream"]||[]).push([[0],{18:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);t.default="\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    //gl_Position = vec4(position, 1.0);\n}"},21:function(e,t,n){"use strict";n.r(t);t.default="\nvarying vec2 vUv;\n\nuniform sampler2D videoTexture;\nuniform vec2 resolution;\n\nvoid main()\n{\n  vec2 uv = vec2(0.5) + vUv * resolution.xy - resolution.xy*0.5;\n  vec4 color = vec4(0.);\n  if (uv.x>=0.0 && uv.y>=0.0 && uv.x<1.0 && uv.y<1.0) color = vec4(texture2D(videoTexture, uv).rgb, 1.0);\n  gl_FragColor = color;\n}\n"},22:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n(2),i=n.n(o),c=n(9),a=n.n(c),s=(n(18),n(4)),u=n(0),d=n(10),l=n(7),v=n.n(l),h=n(11),f=n(8),w=n.n(f),m=n.p+"static/media/fire.5b252a8b.mp4",b=n(12),j=function(e){return Math.floor(Math.random()*e)},p=0,x=20,g=50,O=new u.s(1,30,30),y=new u.p,k=new b.a,E=new u.o,M=new u.t(9999,9999),S=[],z=[],C=function(e){var t=n(20).default,r=n(21).default,o=new u.v(e),i=new u.m(10,10),c=new u.q({uniforms:{resolution:{value:new u.t(1,16/9)},videoTexture:{value:o}},transparent:!0,vertexShader:t,fragmentShader:r,depthWrite:!0,depthTest:!0}),a=new u.g(i,c);a.position.z=-10,a.position.y=.5,y.add(a);var s=new u.b(10,6.5,2),d=new u.i({color:"black"}),l=new u.g(s,d);l.castShadow=!0,l.position.z=-11.1,z.push(l),y.add(l)},P=100,L=function(e){for(var t=e.video,n=void 0===t?document.querySelector("#master"):t,r=e.color,o=e.n,i=void 0===o?1:o,c=0;c<i;c++){var a=new u.c("rgb(".concat(j(255)+20,", ").concat(j(255)+20,", ").concat(j(255)+20,")")),s=O,d=new u.h({color:r||a}),l=new u.g(s,d),v=2*Math.random()*P-100,h=Math.random()*P,f=2*Math.random()*P-100;l.position.set(v,h,f),l.rotation.y=1.5*Math.PI,l.castShadow=!0,n&&(l.vId=n.id.replace("remote-video-","")),y.add(l),S.push(l)}};function A(e){var t=e.changeVolume,n=Object(o.useRef)();return Object(o.useEffect)((function(){var e=n.current,r=e.getContext("2d"),o=e.width,i=e.height;r.rect(0,0,o,i),r.fillStyle="#00ffb1",r.fill();var c=!0;e.onmousedown=function(e){c=!1},e.ontouchstart=function(){return c=!1};var a=function(n){if(!c){var r=e.getBoundingClientRect(),o=e.getContext("2d"),a={x:(n.touches?n.touches[0].clientX:n.clientX)-r.left};o.clearRect(0,0,o.canvas.width,o.canvas.height),o.beginPath(),o.rect(0,0,a.x,i),o.fill(),t(a.x/o.canvas.width)}};e.onmousemove=a,e.ontouchmove=a,document.onmouseup=function(){return c=!0}}),[t]),Object(r.jsx)("div",{id:"volume",children:Object(r.jsx)("canvas",{ref:n})})}function R(e){var t=e.videoRef,n=e.isPlaying,o=e.isMuted,i=e.toggleMute;e.setupAudioContext;return Object(r.jsxs)("div",{id:"controls-container",children:[Object(r.jsx)("div",{onClick:function(){var e=t.current;e.currentTime=e.seekable.end(0)},children:"Go To Live"}),Object(r.jsx)("div",{onClick:function(){var e=t.current;n?e.pause():e.play()},children:n?"Pause":"Play"}),Object(r.jsx)("div",{onClick:i,children:o?"Unmute":"Mute"}),"iPhone"!==navigator.platform&&Object(r.jsx)(A,{changeVolume:function(e){return t.current.volume=(r=0,(n=e)>(o=1)?o:n<r?r:n);var n,r,o}})]})}var B="https://ice.raptor.pizza/hls/meiosis.m3u8";function X(e){var t=e.createScreen,n=(e.phase,e.videoRef),i=e.setupAudioContext,c=e.test,a=void 0!==c&&c,u=e.muteOverride,d=Object(o.useState)(!a),l=Object(s.a)(d,2),f=l[0],b=l[1],j=Object(o.useState)(0),p=Object(s.a)(j,2),x=p[0],g=p[1],O=Object(o.useState)(!1),y=Object(s.a)(O,2),k=y[0],E=y[1],M=Object(o.useState)(!0),S=Object(s.a)(M,2),z=S[0],C=S[1],P=Object(o.useCallback)(Object(h.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.current,e.next=3,fetch(B).then((function(e){return e})).then((function(e){if(404===e.status)return!1;b(!1);var n=B;if(w.a.isSupported()){var r=new w.a;r.loadSource(n),r.attachMedia(t)}else t.src=n}));case 3:case"end":return e.stop()}}),e)}))),[n]);Object(o.useEffect)((function(){C(u)}),[u]),Object(o.useEffect)((function(){P()}),[P]);var L=Object(o.useCallback)((function(){return g(x+1)}),[x]);Object(o.useEffect)((function(){if(f)return x>15?(g(0),P()):void setTimeout(L,1e3)}),[P,L,x,f]),Object(o.useEffect)((function(){n.current.src=m,t(n.current),n.current.onplay=function(){return E(!0)},n.current.onpause=function(){return E(!1)}}),[]),Object(o.useEffect)((function(){var e=n.current;e.muted=!!z}),[z,n]);return Object(r.jsxs)("div",{children:[Object(r.jsx)("video",{id:"artist-stream",className:"video-js",crossOrigin:"true",ref:n,playsInline:!0,autoPlay:!0,loop:!0,controls:!0,muted:!0}),Object(r.jsx)(R,{videoRef:n,isPlaying:k,isMuted:z,toggleMute:function(e){C(!z)},setupAudioContext:i})]})}var I=n(5);function F(e){var t=e.setPhase,n=e.setupAudioContext,i=Object(o.useState)(),c=Object(s.a)(i,2),a=c[0],u=c[1],d=Object(o.useRef)();return Object(o.useEffect)((function(){var e=d.current.getBoundingClientRect();u({marginLeft:-e.width/2+"px",marginTop:-e.height/2+"px",opacity:1})}),[]),Object(r.jsxs)("div",{ref:d,style:Object(I.a)(Object(I.a)({opacity:0},a),{},{transition:"opacity 1s",userSelect:"none",color:"#ff0000"}),className:"centered-cta",children:["Sound?",Object(r.jsxs)("div",{className:"icon-cta",children:[Object(r.jsx)("div",{onClick:function(){n({muted:!1}),t(2)},children:Object(r.jsx)(T,{})}),Object(r.jsx)("div",{onClick:function(){n({muted:!0}),t(2)},children:Object(r.jsx)(N,{})})]})]})}var T=function(){return Object(r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"#ff0000",children:Object(r.jsx)("path",{d:"M3 9v6h-1v-6h1zm13-7l-9 5v2.288l7-3.889v13.202l-7-3.889v2.288l9 5v-20zm-11 5h-5v10h5v-10zm13.008 2.093c.742.743 1.2 1.77 1.198 2.903-.002 1.133-.462 2.158-1.205 2.9l1.219 1.223c1.057-1.053 1.712-2.511 1.715-4.121.002-1.611-.648-3.068-1.702-4.125l-1.225 1.22zm2.142-2.135c1.288 1.292 2.082 3.073 2.079 5.041s-.804 3.75-2.096 5.039l1.25 1.254c1.612-1.608 2.613-3.834 2.616-6.291.005-2.457-.986-4.681-2.595-6.293l-1.254 1.25z"})})},N=function(){return Object(r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"#ff0000",children:Object(r.jsx)("path",{d:"M5 17h-5v-10h5v10zm2-10v10l9 5v-20l-9 5zm15.324 4.993l1.646-1.659-1.324-1.324-1.651 1.67-1.665-1.648-1.316 1.318 1.67 1.657-1.65 1.669 1.318 1.317 1.658-1.672 1.666 1.653 1.324-1.325-1.676-1.656z"})})};var Y,q,W;function U(){var e=Object(o.useState)(0),t=Object(s.a)(e,2),n=t[0],i=t[1],c=Object(o.useState)(!0),a=Object(s.a)(c,2),l=a[0],v=a[1],h=Object(o.useRef)(void 0),f=Object(o.useRef)(void 0);Object(o.useEffect)((function(){if(2===n)try{W.lock(),W.isLocked=!0}catch(e){W.isLocked=!0}}),[n]);var w=function e(t){var n=t.muted;if(console.log("audio context setup"),v(n),"iPhone"!==navigator.platform){var r=new(window.AudioContext||window.webkitAudioContext);Y=r.createAnalyser();var o=r.createMediaElementSource(f.current);o.connect(Y),o.connect(r.destination),Y.fftSize=512;var i=Y.frequencyBinCount;q=new Uint8Array(i),h.current.removeEventListener("click",e,!0),h.current.removeEventListener("touchstart",e,!0)}};return Object(o.useEffect)((function(){if(void 0!==h.current){var e=new u.k(75,window.innerWidth/window.innerHeight,.1,1e3),t=p,n=x,r=g;e.position.set(t,n,r),e.lookAt(0,0,0);var o=!1,c=!1,a=!1,s=!1,l=new u.u,v=new u.u,w=new u.w;w.setClearColor(new u.c(1,1,1)),w.setSize(window.innerWidth,window.innerHeight),w.setPixelRatio(window.devicePixelRatio),w.shadowMap.enabled=!0,w.shadowMap.type=u.j,h.current.appendChild(w.domElement);var m=function(){var e=new u.s(1,20,20),t=new u.h({color:new u.c(1,0,0),transparent:!0}),n=new u.g(e,t);n.name="start-button";var r={x:p,y:x-2,z:g-5,widthSegments:1,heightSegments:1};return n.position.set(r.x,r.y,r.z),y.add(n),n}();!function(){var e=new u.l(200,200,100,100);e.rotateX(-Math.PI/2),e=e.toNonIndexed();var t=new u.i({color:"white"}),n=new u.g(e,t);n.position.y=-2,n.receiveShadow=!0,n.castShadow=!0,n.name="floor",y.add(n)}(),function(){var e=new u.d(16777215,1.9,100);e.position.set(0,70,30),e.target.position.set(0,0,-10),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.5,e.shadow.camera.far=500,e.shadow.camera.left=-50,e.shadow.camera.right=50,e.shadow.camera.top=50,e.shadow.camera.bottom=-50,y.add(e),y.add(e.target)}(),h.current.addEventListener("touchstart",Z,!0),h.current.addEventListener("click",Z,!0);var b=!1,j=!1;document.addEventListener("touchstart",(function(e){var t=function(e){return e.touches||e.originalEvent.touches}(e)[0];O=t.clientX,C=t.clientY,P.set(e.touches[0].clientX,e.touches[0].clientY)}),!1),document.addEventListener("touchend",(function(e){o=!1,c=!1}),!1),document.addEventListener("touchmove",(function(e){if(!b)return;if(A.set(e.touches[0].clientX,e.touches[0].clientY),R.subVectors(A,P),P.copy(A),B+=2*Math.PI*R.y/w.domElement.height*.3,X+=2*Math.PI*R.x/w.domElement.width*.5,!O||!C)return;var t=e.touches[0].clientX,n=e.touches[0].clientY,r=O-t,i=C-n;Math.abs(r)>Math.abs(i)||(i>0?c=!0:o=!0);O=null,C=null}),!1);var O=null,C=null,P=new u.t,A=new u.t,R=new u.t,B=0,X=1*Math.PI/180,I={minPolarAngle:0};I.maxPolarAngle=Math.PI;var F,T,N,U,H=new u.e(0,0,0,"YXZ"),V=new u.a,D=!0,_=new u.n;!function t(){F=requestAnimationFrame(t),B===N&&X===U||b&&(N=B,U=X,H.set(B,X,0,"YXZ"),_.setFromEuler(H),e.quaternion.copy(_));var n=performance.now();if(W&&W.isLocked){v.z=Number(o)-Number(c),v.x=Number(s)-Number(a),v.normalize();var r=(n-T)/1e3;l.x-=10*l.x*r,l.z-=10*l.z*r;var i=W.getObject(),d=new u.u;d.copy(i.position),l.y-=98*r,(o||c)&&(l.z-=400*v.z*r),(a||s)&&(l.x-=400*v.x*r),W.moveRight(-l.x*r),W.moveForward(-l.z*r);var h=new u.r(i.position,2);if(z.length>0){var f=z[0];f.geometry.computeBoundingBox(),V.copy(f.geometry.boundingBox).applyMatrix4(f.matrixWorld),h.intersectsBox(V)&&(l.y=Math.max(0,l.y),0===W.getObject().position.y&&i.position.copy(d),D=!0)}W.getObject().position.y+=l.y*r,W.getObject().position.y<0&&(l.y=0,W.getObject().position.y=0,D=!0)}T=n,Y&&Y.getByteFrequencyData(q);for(var m=0;m<S.length;m++){S[m].rotation.y+=.01;var j=Math.sin(.001*n+m);if(S[m].scale.set(j,j,j),Y){var p=q[m%256]/100;S[m].scale.set(p,p,p)}}w.render(y,e),k.update()}();var J=function(){e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),w.setSize(window.innerWidth,window.innerHeight)};return window.addEventListener("resize",J,!1),function(){cancelAnimationFrame(F),window.removeEventListener("resize",J,!1)}}function Z(t){if(function(e){var t={x:0,y:0};e instanceof TouchEvent?(t.x=e.touches[0].clientX,t.y=e.touches[0].clientY):(t.x=e.clientX,t.y=e.clientY),M.x=t.x/window.innerWidth*2-1,M.y=-t.y/window.innerHeight*2+1}(t),E.setFromCamera(M,e),E.intersectObjects([m]).length>0){if(f.current.play(),!j){j=!0;var n,r=performance.now(),v=m.material.color;!function t(){var f=.001*(performance.now()-r);if(m.material.color.set(v.lerp(new u.c(0,0,1),f)),m.material.opacity=function(e,t,n){return e*(n-t)+t}(f-1,1,0),i(1),f>2)return b=!0,W=new d.a(e,h.current),h.current.addEventListener("click",(function(){return W.lock()})),y.add(W.getObject()),document.addEventListener("keydown",(function(e){switch(e.key){case"w":o=!0;break;case"a":a=!0;break;case"s":c=!0;break;case"d":s=!0;break;case" ":D&&(l.y+=100),D=!1}}),!1),document.addEventListener("keyup",(function(e){switch(e.key){case"w":o=!1;break;case"a":a=!1;break;case"s":c=!1;break;case"d":s=!1}}),!1),L({n:1e3}),cancelAnimationFrame(n);n=requestAnimationFrame(t)}()}h.current.removeEventListener("click",Z,!0),h.current.removeEventListener("touchstart",Z,!0)}}}),[]),Object(r.jsxs)("div",{style:{width:"100%",height:"100%"},ref:h,children:[1===n&&Object(r.jsx)(F,{setupAudioContext:w,setPhase:i}),Object(r.jsx)(X,{createScreen:C,phase:n,videoRef:f,test:false,setupAudioContext:w,muteOverride:l})]})}function H(){return Object(r.jsx)("div",{children:Object(r.jsx)(U,{})})}a.a.render(Object(r.jsx)(i.a.StrictMode,{children:Object(r.jsx)(H,{})}),document.getElementById("root"))}},[[22,1,2]]]);
//# sourceMappingURL=main.ec0693a5.chunk.js.map